{% extends 'layout.html'%}
{% load static %}
{% load auth_extras %}
{% block title %}
DashBoard
{% endblock %}
{% block css %}
<link href="https://cdnjs.cloudflare.com/ajax/libs/bootstrap-datepicker/1.2.0/css/datepicker.min.css" rel="stylesheet">
<script src="https://cdn.jsdelivr.net/npm/apexcharts"></script>
{% endblock %}
{% block body %}
<style>
    .datepicker {
        float: right
    }

    .datepicker.dropdown-menu {
        right: auto
    }

    .loader-dis {
        display: flex;
        justify-content: center;
    }

    .loader {
        -webkit-animation: spin 2s linear infinite;
        /* Safari */
        animation: spin 2s linear infinite;
    }

    .loader-sm {
        border: 8px solid #f3f3f3;
        border-radius: 50% !important;
        border-top: 8px solid #3498db;
        width: 65px;
        height: 65px;
    }

    /* Safari */
    @-webkit-keyframes spin {
        0% {
            -webkit-transform: rotate(0deg);
        }

        100% {
            -webkit-transform: rotate(360deg);
        }
    }

    @keyframes spin {
        0% {
            transform: rotate(0deg);
        }

        100% {
            transform: rotate(360deg);
        }
    }
</style>

<div class="row" dir="rtl">
    <div class="col-lg-3 col-md-3 col-sm-6 col-xs-12">
        <div class="dashboard-stat blue-madison">
            <div class="visual">
                <i class="fa fa-comments"></i>
            </div>
            <div class="details">
                <div class="loader loader-sm"></div>
                <div class="number" id="doctors-count" style="display: none;">
                </div>
                <div class="desc">
                    doctors
                </div>
            </div>

        </div>
    </div>
    <div class="col-lg-3 col-md-3 col-sm-6 col-xs-12">
        <div class="dashboard-stat red-intense">
            <div class="visual">
                <i class="fa fa-bar-chart-o"></i>
            </div>
            <div class="details">
                <div class="loader loader-sm"></div>
                <div class="number" id="patients_count" style="display: none;">
                </div>
                <div class="desc">
                    patients
                </div>
            </div>

        </div>
    </div>
    <div class="col-lg-3 col-md-3 col-sm-6 col-xs-12">
        <div class="dashboard-stat green-haze">
            <div class="visual">
                <i class="fa fa-shopping-cart"></i>
            </div>
            <div class="details">
                <div class="loader loader-sm"></div>
                <div class="number" id="month-count" style="display: none;">
                </div>
                <div class="desc">
                    monthly-profits
                </div>
            </div>

        </div>
    </div>
    <div class="col-lg-3 col-md-3 col-sm-6 col-xs-12">
        <div class="dashboard-stat purple-plum">
            <div class="visual">
                <i class="fa fa-globe"></i>
            </div>
            <div class="details">
                <div class="number" id="year-count" style="display: none;">
                </div>
                <div class="desc">
                    Yearly Profits
                </div>
            </div>

        </div>
    </div>
</div>
{% if request.user|has_group:"test" or perms.branches.add_branch %}
<div class="row">
    <div class="col-md-12">
        <!-- BEGIN CHART PORTLET-->
        <div class="portlet light bordered">
            <div class="portlet-title">
                <div class="caption">
                    <input type="text" class="form-control" name="datepicker" id="datepicker" />
                </div>
                <div class="tools">
                    <a href="javascript:;" class="collapse">
                    </a>
                    <a href="#portlet-config" data-toggle="modal" class="config">
                    </a>
                    <a href="javascript:;" class="reload">
                    </a>
                    <a href="javascript:;" class="fullscreen">
                    </a>
                    <a href="javascript:;" class="remove">
                    </a>
                </div>
            </div>

            <div class="portlet-body" id="chart-continer">


                <div id="chart"></div>








            </div>

        </div>
    </div>
    <!-- END CHART PORTLET-->
</div>
{% endif %}
</div>


{% endblock %}
{% block js %}
<script src="{% static 'admin_assets/js/bootstrap-datepicker.js' %}" type="text/javascript"></script>

<script>
    var price;
    var month;
    $(function () {

        $.ajax({
            url: "get-profits",
            method: "get",
            data: {
                //_token: '',
                //datepicker: datepicker
            },

            success: function (html) {
                alert(html.month)
                let options = {
                    chart: {
                        type: 'bar'
                    },
                    series: [{
                        name: 'Price',
                        data: html.price
                    }],
                    xaxis: {
                        categories: html.month
                    }
                }

                var chart = new ApexCharts(document.querySelector("#chart"), options);

                chart.render();
                //$('#chart-continer').html(html);

            }
        });
    })

    // Using the |safe filter for simple lists (be cautious with untrusted data)
    //var price = {{ price| safe }};
    //var month = {{ month| safe }};
    // alert(month)

    //alert(data);


    // let options = {
    //     chart: {
    //         type: 'bar'
    //     },
    //     series: [{
    //         name: 'Price',
    //         data: price
    //     }],
    //     xaxis: {
    //         categories: month
    //     }
    // }

    // var chart = new ApexCharts(document.querySelector("#chart"), options);

    // chart.render();

</script>
<script>


    $.ajax({
        url: "get-profits",
        method: "get",
        data: {
            _token: '',
            datepicker: datepicker
        },

        success: function (html) {
            alert("dasd")
            $('#chart-continer').html(html);
        }
    });


</script>

<script>
    $(function () {
        $.ajax({
            url: 'top',
            method: "get",
            success: function (html) {
                $('.details .loader-sm').hide();
                $('#doctors-count').show();
                $('#doctors-count').html(html.data.doctors_count);

                $('#patients_count').show();
                $('#patients_count').html(html.data.patients_count);

                $('#month-count').show();
                $('#month-count').html(html.data.month_profits);

                $('#year-count').show();
                $('#year-count').html(html.data.year_profits);

            }
        });
    })
</script>


{% endblock %}